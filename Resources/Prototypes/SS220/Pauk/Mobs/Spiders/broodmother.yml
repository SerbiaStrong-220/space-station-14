- type: entity
  parent: [ SimpleSpaceMobBase, FlyingMobBase ]
  id: paukBaseMobDragon
  suffix: ""
  name: paukspace dragon
  description: A flying leviathan, loosely related to space carps.
  abstract: true
  components:
  - type: GhostRole
    allowMovement: true
    allowSpeech: true
    makeSentient: true
    name: ghost-role-information-space-dragon-name
    description: ghost-role-information-space-dragon-description
  - type: GhostTakeoverAvailable
  - type: HTN
    rootTask:
      task: XenoCompound
    blackboard:
      NavInteract: !type:Bool
        true
      NavPry: !type:Bool
        true
      NavSmash: !type:Bool
        true
  - type: NpcFactionMember
    factions:
    - Dragon
  - type: Speech
    speechVerb: LargeMob
  - type: CombatMode
  - type: MobMover
  - type: InputMover
  - type: MovementSpeedModifier
    baseWalkSpeed: 3
    baseSprintSpeed: 5
    weightlessModifier: 1.5
  - type: RandomSprite
    available:
    - enum.DamageStateVisualLayers.Base:
        alive: Rainbow
  - type: Sprite
    sprite: Mobs/Aliens/Carps/dragon.rsi
    noRot: true
    layers:
    - map: [ "enum.DamageStateVisualLayers.Base" ]
      state: alive
    - map: [ "enum.DamageStateVisualLayers.BaseUnshaded" ]
      state: alive-unshaded
      shader: unshaded
  - type: Appearance
  - type: DamageStateVisuals
    states:
      Alive:
        Base: alive
        BaseUnshaded: alive-unshaded
      Critical:
        Base: crit
      Dead:
        Base: dead
        BaseUnshaded: dead-unshaded
  - type: Physics
    bodyType: KinematicController
  - type: Fixtures
    fixtures:
      fix1:
        shape:
          !type:PhysShapeCircle
          radius: 0.40
        density: 100
        mask:
        - FlyingMobMask
        layer:
        - FlyingMobLayer
  - type: MobState
  - type: MobStateActions
    actions:
      Critical:
      - ActionCritSuccumb
      - ActionCritLastWords
  - type: MobThresholds
    thresholds:
      0: Alive
      450: Critical
      500: Dead
  - type: Metabolizer
    solutionOnBody: false
    updateFrequency: 0.25
    metabolizerTypes: [ Dragon ]
    groups:
    - id: Medicine
    - id: Poison
  - type: Butcherable
    spawned:
    - id: FoodMeatDragon
      amount: 2
  - type: InteractionPopup
    successChance: 0.25 # It's no goose, but you better smell like carp.
    interactSuccessString: petting-success-dragon
    interactFailureString: petting-failure-dragon
    interactFailureSound:
      path: /Audio/Animals/space_dragon_roar.ogg
    soundPerceivedByOthers: false # A 75% chance for a loud roar would get old fast.
  - type: MeleeWeapon
    altDisarm: false
    soundHit:
      path: /Audio/Weapons/Xeno/alien_claw_flesh3.ogg
    damage:
      types:
        Piercing: 15
        Slash: 15
  - type: Devourer
    foodPreference: Humanoid
    shouldStoreDevoured: true
    chemical: Ichor
    healRate: 15.0
    whitelist:
      components:
      - MobState
      - Door
      tags:
      - Wall
  - type: Tag
    tags:
    - CannotSuicide
  - type: ReplacementAccent #SS220 No talking dragons
    accent: genericAggressive

- type: entity
  parent: paukBaseMobDragon
  id: paukMobDragon
  components:
  - type: Dragon
    spawnsLeft: 1
    spawnsProto: PaukEssenceFirst
    spawnRiftAction: PaukActionSpawnIncome
  - type: GenericAntag
    rule: Dragon

- type: entity
  id: PaukIncome
  name: carp rift
  description: A rift akin to the ones space carp use to travel long distances.
  placement:
    mode: SnapgridCenter
  components:
  - type: DragonRift
  - type: Transform
    anchored: true
  - type: Physics
    bodyType: Static
    canCollide: false
  - type: Fixtures
  - type: Sprite
    layers:
    - sprite: Structures/Specific/carp_rift.rsi
      state: icon
      color: "#569fff"
      shader: unshaded
  - type: InteractionOutline
  - type: Clickable
  - type: PointLight
    enabled: true
    color: "#366db5"
    radius: 10.0
    energy: 5.0
    netsync: false
  - type: NavMapBeacon
    color: "#ff0000"
    text: carp rift
    # only show after making the announcement at 50%
    enabled: false
  - type: Damageable
    damageContainer: Inorganic
    damageModifierSet: Metallic
  - type: Destructible
    thresholds:
    - trigger:
        !type:DamageTrigger
        damage: 300
      behaviors:
      - !type:DoActsBehavior
        acts: [ "Destruction" ]
  - type: EmitSoundOnSpawn
    sound:
      path: /Audio/Weapons/Guns/Gunshots/rocket_launcher.ogg

- type: entity
  id: PaukActionSpawnIncome
  name: Summon Carp Rift
  description: Summons a carp rift that will periodically spawns carps.
  noSpawn: true
  components:
  - type: InstantAction
    icon:
      sprite: Interface/Actions/carp_rift.rsi
      state: icon
    event: !type:DragonSpawnRiftActionEvent
    useDelay: 1