using Content.Shared.SS220.Paper;
using Robust.Client.AutoGenerated;
using Robust.Client.Player;
using Robust.Client.UserInterface.Controls;
using Robust.Client.UserInterface.CustomControls;
using Robust.Client.UserInterface.XAML;

namespace Content.Client.SS220.Paper.UI;

[GenerateTypedNameReferences]
public sealed partial class DocumentHelperPopup : DefaultWindow
{
    [Dependency] private readonly IEntityManager _entityManager = default!;
    [Dependency] private readonly IPlayerManager _player = default!;

    private readonly PaperAutoFormSystem _paperAutoForm;

    public event Action<string>? OnButtonPressed;

    public DocumentHelperPopup()
    {
        IoCManager.InjectDependencies(this);
        RobustXamlLoader.Load(this);
        _paperAutoForm = _entityManager.System<PaperAutoFormSystem>();

        foreach (var option in _paperAutoForm.GetOptionsList(_player.LocalEntity))
        {
            var button = new Button
            {
                Text = option
            };
            OptionsContainer.AddChild(button);

            button.OnPressed += _ => OnButtonPressed?.Invoke(button.Text);
        }
    }
}
