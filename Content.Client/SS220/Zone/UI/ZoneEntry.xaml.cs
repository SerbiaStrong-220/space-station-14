// Â© SS220, An EULA/CLA with a hosting restriction, full text: https://raw.githubusercontent.com/SerbiaStrong-220/space-station-14/master/CLA.txt
using Content.Client.SS220.UserInterface.Utility;
using Content.Client.SS220.Zone.Systems;
using Content.Client.Stylesheets;
using Content.Shared.SS220.Zone.Components;
using Robust.Client.AutoGenerated;
using Robust.Client.Graphics;
using Robust.Client.UserInterface.Controls;
using Robust.Client.UserInterface.XAML;

namespace Content.Client.SS220.Zone.UI;

[GenerateTypedNameReferences]
public sealed partial class ZoneEntry : ContainerButton
{
    [Dependency] private readonly IEntityManager _entityManager = default!;

    private readonly ZoneSystem _zones;

    public Entity<ZoneComponent> ZoneEntity;

    private static Dictionary<uint, ConfirmableButtonState> ConfirmableButtonStates => new()
    {
        [0] = new ConfirmableButtonState(Loc.GetString("zone-entry-delete-zone-button"), null),
        [1] = new ConfirmableButtonState(Loc.GetString("zones-control-are-you-sure"), StyleNano.ButtonColorCautionDefault)
    };

    private static Color BackgroundColor => Color.FromHex("#2F2F3B");

    public ZoneEntry(Entity<ZoneComponent> entity)
    {
        IoCManager.InjectDependencies(this);
        RobustXamlLoader.Load(this);

        _zones = _entityManager.System<ZoneSystem>();
        ZoneEntity = entity;

        BackgroundPanel.PanelOverride = new StyleBoxFlat { BackgroundColor = BackgroundColor };
        AddStyleClass(StyleClassButton);
        DeleteZoneButton.SetClickState(ConfirmableButtonStates);
        DeleteZoneButton.OnConfirmed += () => _zones.DeleteZoneRequest(_entityManager.GetNetEntity(entity));

        Refresh();
    }

    public void Refresh()
    {
        IDLabel.Text = _entityManager.GetNetEntity(ZoneEntity).ToString();
        NameLabel.Text = _entityManager.TryGetComponent<MetaDataComponent>(ZoneEntity, out var zoneMeta)
            ? zoneMeta.EntityName
            : "Unknown";
    }

    public string GetFilteringString()
    {
        return $"{IDLabel.Text} {NameLabel.Text}";
    }
}
